from development_workforce.ado_integrations.ado_workitems_api_tools import AdoWorkitemsApiTools
from development_workforce.ado_integrations.mock_ado_workitems_api import AdoWorkItem, MockAdoWorkitemsApi

import pytest

class Test_AdoWorkitemsApiTools2:

    @pytest.fixture
    def mock_ado_workitems_api(self):
        return MockAdoWorkitemsApi()

    @pytest.fixture
    def add_ado_test_item(self, mock_ado_workitems_api):
        work_item = AdoWorkItem(id=12345, type='Bug', assigned_to='John')
        mock_ado_workitems_api.work_items.append(work_item)
        return work_item.id

    @pytest.fixture
    def ado_workitems_api_tools(self, mock_ado_workitems_api):
        return AdoWorkitemsApiTools(mock_ado_workitems_api)

    def test_create_work_item(self, mock_ado_workitems_api, ado_workitems_api_tools):
        work_item = {"title": "Test Work Item", "description": "This is a test work item"}
        work_item_id = ado_workitems_api_tools.create_work_item(work_item)
        assert isinstance(work_item_id, int)
        assert len(mock_ado_workitems_api.work_items) == 1

    def test_get_work_item(self, ado_workitems_api_tools, add_ado_test_item: int):
        work_item = ado_workitems_api_tools.get_work_item(add_ado_test_item)
        assert isinstance(work_item, dict)
        assert work_item["id"] == add_ado_test_item

    def test_update_work_item(self, ado_workitems_api_tools, mock_ado_workitems_api, add_ado_test_item: int):
        updated_work_item = {"title": "Updated Work Item", "description": "This is an updated work item"}
        ado_workitems_api_tools.update_work_item(add_ado_test_item, updated_work_item)
        assert mock_ado_workitems_api.work_items[0].title == updated_work_item["title"]

    def test_delete_work_item(self, ado_workitems_api_tools, mock_ado_workitems_api, add_ado_test_item: int):
        ado_workitems_api_tools.delete_work_item(add_ado_test_item)
        assert mock_ado_workitems_api.work_items == []

    def test_list_work_items(self, ado_workitems_api_tools: AdoWorkitemsApiTools, mock_ado_workitems_api , add_ado_test_item: int):
        work_items = ado_workitems_api_tools.list_work_items()
        assert isinstance(work_items, list)
        assert mock_ado_workitems_api.work_items == work_items
